<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Countour Trace</title>
</head>
<body>
<canvas id="thecanvas" width=800 height=800></canvas>
<script type="text/javascript" src="src/tracepaths.js"></script>
<script type="text/javascript">
let cvs = document.getElementById('thecanvas');
let ctx = cvs.getContext('2d');
ctx.scale(10, 10);

/*
{
    let path = trace(
                  [1, 0, 0,
                   0, 1, 0,
                   0, 0, 1], 3, 3);
    if (path != 'M0 0H1V1H0ZM1 1H2V2H1ZM2 2H3V3H2Z') {
        console.log('>', path);
        throw 'bad path';
    }
    ctx.translate(5, 3);
    ctx.fill(new Path2D(path));
}

{
    let path = trace(
            [0,1,1,1,0,0,1,1,1,1,1,
             1,0,0,0,1,0,1,0,0,0,1,
             1,0,0,0,1,0,1,0,1,0,1,
             1,0,0,0,1,0,1,0,0,0,1,
             0,1,1,1,0,0,1,1,1,1,1], 11, 5);
    if (path != "M1 0H4V1H1ZM6 0H11V5H6ZM0 1H1V4H0ZM4 1H5V4H4ZM7 1V4H10V1ZM8 2H9V3H8ZM1 4H4V5H1Z") {
        console.log('>', path);
        throw 'bad path';
    }
    ctx.translate(5, 0);
    ctx.fill(new Path2D(path));
}

{
    let path = trace(
                [1,0,0,0,0,0,0,0,0,
                 1,0,1,1,1,1,1,1,1,
                 1,0,1,0,0,0,0,0,1,
                 1,0,1,0,1,1,1,0,1,
                 1,0,1,0,1,0,1,0,1,
                 1,0,1,0,0,0,1,0,1,
                 1,0,1,1,1,1,1,0,1,
                 1,0,0,0,0,0,0,0,1,
                 1,1,1,1,1,1,1,1,1], 9, 9);
    if (path != 'M0 0H1V8H8V2H3V6H6V4H5V5H4V3H7V7H2V1H9V9H0Z') {
        console.log('>', path);
        throw 'bad path';
    }
    ctx.translate(0, 8);
    ctx.fill(new Path2D(path));
}
*/

{
    let path = trace(
        [ 1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,1,1,0,1,1,1,1,1,0,0,1,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,0,1,1,0,0,1,0,1,0,1,1,0,0,1,1,0,0,0,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,0,1,1,0,0,0,1,1,0,0,0,0,1,0,1,0,1,0,0,1,1,0,0,1,1,1,0,0,1,0,1,0,1,0,1,0,1,1,0,0,1,0,0,1,1,1,0,1,0,1,0,0,1,0,0,0,0,1,0,1,1,0,1,0,0,0,0,1,0,0,0,1,1,1,1,0,1,0,0,0,0,0,0,1,0,0,0,1,1,1,1,0,1,1,1,1,0,0,1,0,0,0,1,1,1,1,1,1,1,0,0,1,1,0,1,0,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,1,0,1,0,0,1,0,1,1,0,0,0,1,1,0,1,0,0,1,1,1,1,1,0,1,0,0,1,0,1,0,0,0,1,1,1,1,0,1,0,1,1,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,0,1,0,0,1,1,0,1,0,1,0,1,0,1,0,0,0,1,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,1,0,0,1,1,0,1,1,1,0,1,1,0,0,1,1,1,1,1,0,0,1,0,1,1,1,1,0,1,0,1,1,0,1,1,0,1,1,1,0,1,0,0,1,1,1,0,0,1,0,0,0,1,1,1,0,1,1,1,0,0,1,1,1,1,1,0,0,1,0,1,1,1,0,1,0,1,0,1,0,1,0,0,1,1,0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,0,0,1,1,1,0,0,1,1,0,1,0,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,1,1,0,1,0,1,0,1,1,0,1,1,0,0,0,0,1,1,0,0,1,0,1,1,1,0,1,1,1,1,0,1,0,1,1,0,0,0,0,0,1,0,0,1,1,0,1,0,1,0,1,1,0,1,0,1,1,1,0,1,0,1,0,1,0,1,1,1,0,1,1,1,1,0,1,1,0,0,1,1,1,0,0,1,1,1,1,1,1,0,1,1,0,0,0,0,1,1,1,0,0,0,0,1,0,1,0,1,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,1,1,0,0,0,1,0,0,1,1,1,0,0,1,1,1,0,1,1,0,1,1,0,0,0,0,1,1,1,0,0,1,1,1,1,1,1,1,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,1,1,1,1,1,1,1,0,1,1,0,0,0,0,1,1,1,1,1,1,0,1,0,1,1,0,0,0,0,1,1,1,0,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,0,1,1,0,0,1,0,0,1,1,1,0,1,0,1,1,1,1,0,0,1,1,1,0,0,0,1,0,1,0,0,1,1,1,1,1,0,0,0,0,0,1,0,1,0,1,0,0,0,1,0,0,0,0,1,0,1,0,1,0,1,0,0,0,0,1,0,1,1,0,1,1,0,0,0,1,1,0,1,1,1,1,1,1,1,1,0,0,0,1,0,0,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,0,1,1,1,1,0,1,0,0,0,0,1,1,0,0,1,0,1,1,1,0,0,1,0,1,0,0,0,0,0,0,1,0,0,0,1,0,1,1,0,0,1,1,1,0,1,0,1,0,0,0,1,0,1,1,0,1,0,1,0,0,1,1,1,1,0,0,0,0,0,1,0,0,1,1,0,0,1,1,1,1,0,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 ], 32, 32);
    /*
    if (path != qrpath) {
        console.log('>', path);
        throw 'bad path';
    }
    */
    ctx.translate(15, -3);
    ctx.fill(new Path2D(path));
}

function trace(pixs, w, h) {
    // Invert the grid for postscript notation
    let grid = [];
    let idx = 0;
    for (let y = h-1; y >= 0; y--) {
        for (let x = 0; x < w; x++) {
            grid[idx++] = pixs[y*w + x];
        }
    }
    return tosvg(tracepaths(grid, w, h));
}

function tosvg(paths) {
    let svg = '';
    for (let p = 0; p < paths.length; p++) {
        let path = paths[p];
        let tx = path[0][0], ty = path[0][1];

        svg += 'M' + tx + ' ' + ty;
        for (let i = 1; i < path.length; i++) {
            let ix = path[i][0];
            let iy = path[i][1];
            if (ix == tx) {
                svg += 'V' + iy;
                ty = iy;
            } else {
                svg += 'H' + ix;
                tx = ix;
            }
        }
        svg += 'Z';
    }
    return svg;
}
</script>
</body>
</html>
